<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><meta content="width=device-width, initial-scale=1.0;" name="viewport" /><title>6.0.0's Changes</title><link href="/stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/all.css" rel="stylesheet" type="text/css" /><link href="favicon.png" rel="icon" type="image/png" /></head><body class="page_classes blog blog_2015 blog_2015_11 blog_2015_11_15 blog_2015_11_15_6-0-0s_changes"><header class="navbar navbar-static-top"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" data-target=".bs-navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="/images/logo.png" /></a></div><nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation"><ul class="nav navbar-nav"><li><a href="../../../../#latest-news">News</a></li><li><a href="http://neo4jrb.readthedocs.org/">Documentation</a></li><li><a href="../../../../#getting-started">Get started</a></li><li><a href="../../../../#getting-involved">Get involved</a></li><li><a href="../../../../#getting-help">Getting Help</a></li></ul></nav></div></header><div class="container" id="main"><div class="row"><div class="col-xs-8" id="content"><div class="panel blog-post"><div class="panel-heading"><h2>6.0.0's Changes</h2></div><div class="panel-body"><p>After a long dev process, the release of 6.0 is upon us. As usual, this release includes heavy internal refactoring, but it also includes more than a few changes that you should be aware of before your upgrade. This is not at all an exhaustive list, so please see the changelog <a href="https://github.com/neo4jrb/neo4j/blob/master/CHANGELOG.md#600rc1---11-13-2015">here</a> if you want a full summary.</p>

<h2>Changes</h2>

<h3><code>_classname</code> has been removed, Neo4j &lt; 2.1.5 is officially unsupported</h3>

<p><strong>Matters if</strong> you use Neo4j &lt; 2.1.5 or explicitly use the <code>_classname</code> property.</p>

<p>The <code>_classname</code> feature was necessary for performance prior to 2.1.5 and may have been considered helpful after that, but we had not been testing against this version of the database for some time and the related code was not under heavy scrutiny. In the interest of being able to focus on support of modern versions of the database and keep general gem maintenance responsibilities focused on areas that matter most to users, this feature has been completely removed.</p>

<h3>Relationships created with <code>&lt;&lt;</code> will use <code>ActiveRel</code> class if the <code>rel_class</code> option is set</h3>

<p><strong>Matters if</strong> you use <code>ActiveRel</code> but do not always use <code>RelClass.create</code>.</p>

<p>This has been on the table for a while but there was some concern that users might prefer the option of bypassing rel classes entirely. We ultimately agreed that <em>not</em> using the rel class when given felt like unexpected behavior.</p>

<h3>Errors will be raised if trying to create both an index and constraint on the same property in a model</h3>

<p><strong>Matters if</strong> you were erroneously doing this.</p>

<p>In Neo4j, unique constraints provide exact indexes. Because of this, it is both unnecessary and impossible to manually set both. The gem, however, would help you out: if you tried to create an index and it found a constraint, it would drop the constraint, or vice versa. This could result in locks or hangs within an app when new sessions were started. As of 6.0, you will encounter an error if you try to do this.</p>

<p>If you run into this error, the solution is simple: remove the option to add an index in your model.</p>

<h3>Settings that result in Cypher using <code>CREATE UNIQUE</code> for rel creation now accept arguments</h3>

<p><strong>Matters if</strong> you are using <code>creates_unique</code> in <code>ActiveRel</code> or <code>unique: true</code> with an association.</p>

<p>Up until now, both <code>ActiveRel</code> and <code>QueryProxy#&lt;&lt;</code>&#39;s <code>CREATE UNIQUE</code> option was very basic: any properties present in the rel creation would have an impact on whether a new relationship was actually created. We agreed that this did not reflect most users&#39; expectations, which were that the only actors in the determination of whether a relationship would be created would be the nodes, rel type, and rel direction. With 6.0, we introduce options and a change to the default.</p>

<p>Under the new default setting, properties will be ignored when creating the relationship. Regardless of how many properties are set or their values, you will not create a new rel if you have the same nodes, rel type, and direction involved.
If your option is <code>:all</code>, all properties will be made part of the <code>CREATE UNIQUE</code> Cypher query, so if there is not an exact match, you will create a new relationship.
If your option is <code>{ on: [keys] }</code>, the properties corresponding with the list given as <code>keys</code> will be evaluated as part of the <code>CREATE UNIQUE</code> query, the rest will be set after the relationship is created.</p>

<p>These rules are true for both <code>ActiveRel#creates_unique</code> and the <code>Association</code> option.  You can see the PR and discussion about this <a href="https://github.com/neo4jrb/neo4j/pull/1038">here</a> for more details.</p>

<h2>Additions</h2>

<h3>Support for <code>config/neo4j.yml</code></h3>

<p>Many of us find YAML configs easier to work with, particularly in different environments. See <a href="https://github.com/neo4jrb/neo4j/blob/d11b99c3902504a0168b042d0e72a86ce0ddf139/docs/Setup.rst#rails-configuration">the docs</a> for an example.</p>

<h3>Three-argument syntax for <code>ActiveRel.new</code> and <code>create</code></h3>

<p>Many of us found the process of inserting <code>from_node</code> and <code>to_node</code> keys into the mass-assignment hash tedious when creating <code>ActiveRel</code> instances, so we have a new, alternative syntax: <code>MyRelClass.new(from_node, to_node, properties)</code>. The original signature is still valid, so there is nothing to change if you are happy with the classic way of doing things.</p>

<h3><code>ActiveRel</code> supports unpersisted nodes</h3>

<p>A typical rel-creation pattern looks like this:</p>

<pre><code>Neo4j::Transaction.run do
    from_node = NodeClass1.create
    to_node   = NodeClass2.create
    rel       = MyRelClass.create(from_node, to_node, properties)
end
</code></pre>

<p>That&#39;s three queries plus the transaction&#39;s close. In 6.0.0, you can do this:</p>

<pre><code>from_node = NodeClass1.new
to_node   = NodeClass2.new
rel       = MyRelClass.create(from_node, to_node, properties)
</code></pre>

<p>It will perform all callbacks and validations, add default properties and UUIDs, and create both nodes and the rel in a single Cypher statement. It&#39;s about 17% faster than handling it in three queries and it might simplify your workflow quite a bit.</p>

<hr>

<p>Those are the big ones but there are bug fixes, new classes for performing schema operations and building Cypher <code>CREATE</code> or <code>MATCH</code> statements, and general refactoring all over the place. Neo4j.rb 6.0.0 closes out a busy year for the project with our best release yet and we&#39;re looking forward to what 2016 brings.</p>
</div><small>Posted 2015/11/15 by Neo4j.rb Team<br /></small></div></div><div class="col-sm-1"></div><div class="col-sm-3" id="sidebar"><div class="panel"><div class="panel-body"><p class="git-stats build-info"></p><p class="latest-release build-info"></p><p class="git-star build-info"><iframe allowtransparency="true" frameborder="0" height="20" scrolling="0" src="http://ghbtns.com/github-btn.html?user=neo4jrb&repo=neo4j&type=watch&count=true&size=small" width="110"></iframe></p><p><a href="https://travis-ci.org/neo4jrb/neo4j"><img src="https://travis-ci.org/neo4jrb/neo4j.svg?branch=master" /></a></p><p><a href="https://coveralls.io/r/neo4jrb/neo4j?branch=master"><img src="https://coveralls.io/repos/neo4jrb/neo4j/badge.png?branch=master" /></a></p><a href="https://codeclimate.com/github/neo4jrb/neo4j"><img src="https://codeclimate.com/github/neo4jrb/neo4j/badges/gpa.svg" /></a></div></div><div class="panel"><div class="panel-header"><h3>Primary maintainers</h3></div><div class="panel-body"><div class="maintainer"><h4>Heinrich Klobuczek</h4><div class="media"><div class="media-left"><img src="https://avatars.githubusercontent.com/klobuczek" /></div><div class="media-body"><div><i class="fa fa-github"></i> <a href="https://github.com/klobuczek/">klobuczek</a></div><div><i class="fa fa-twitter"></i> <a href="https://twitter.com/klobuczek">klobuczek</a></div></div></div></div><div class="maintainer"><h4>Amit Suryavanshi</h4><div class="media"><div class="media-left"><img src="https://avatars.githubusercontent.com/amitsuryavanshi" /></div><div class="media-body"><div><i class="fa fa-github"></i><a href="https://github.com/amitsuryavanshi/">amitsuryavanshi</a></div><div><i class="fa fa-twitter"></i><a href="https://twitter.com/amitsuryavanshi">amitsuryavanshi</a></div></div></div></div></div><div class="panel-header"><h3>Original Creator</h3></div><div class="panel-body"><div class="maintainer"><h4>Andreas Ronge</h4><div class="media"><div class="media-left"><img src="https://avatars.githubusercontent.com/andreasronge" /></div><div class="media-body"><div><i class="fa fa-external-link"></i> <a href="http://www.jayway.com/author/andreasronge/">Blog</a></div><div><i class="fa fa-github"></i> <a href="https://github.com/andreasronge">andreasronge</a></div><div><i class="fa fa-twitter"></i> <a href="https://twitter.com/ronge">ronge</a></div></div></div></div></div></div><div class="panel"><div class="panel-body"><script data-gratipay-username="cheerfulstoic" src="//grtp.co/v1.js"></script></div></div></div></div></div><script src="/javascripts/all.js" type="text/javascript"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-57970757-1', 'auto');
ga('send', 'pageview');</script></body></html>