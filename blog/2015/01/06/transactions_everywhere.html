<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><meta content="width=device-width, initial-scale=1.0;" name="viewport" /><title>Transactions Everywhere</title><link href="/stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/all.css" rel="stylesheet" type="text/css" /><link href="favicon.png" rel="icon" type="image/png" /></head><body class="page_classes blog blog_2015 blog_2015_01 blog_2015_01_06 blog_2015_01_06_transactions_everywhere"><header class="navbar navbar-static-top"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" data-target=".bs-navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="/images/logo.png" /></a></div><nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation"><ul class="nav navbar-nav"><li><a href="../../../../#latest-news">News</a></li><li><a href="http://neo4jrb.readthedocs.org/">Documentation</a></li><li><a href="../../../../#getting-started">Get started</a></li><li><a href="../../../../#getting-involved">Get involved</a></li><li><a href="../../../../#getting-help">Getting Help</a></li></ul></nav></div></header><div class="container" id="main"><div class="row"><div class="col-xs-8" id="content"><div class="panel blog-post"><div class="panel-heading"><h2>Transactions Everywhere</h2></div><div class="panel-body"><p>Neo4j is ACID-compliant, meaning that when it says that an action is complete, you can trust that it means it. To achieve this over the course of a series of actions, it offers transactions: every action occurring within a single or series of transaction(s) can be committed or rolled back as a group. Neo4j.rb 3.0 had limited support for transactions when it was released, then full support was added in an update soon after. Wrapping actions in a transaction is easy.</p>

<pre><code class="ruby">Neo4j::Transaction.run do |tx|
  s = Student.create(name: &#39;Jasmine&#39;)
  l = Lesson.create(subject: &#39;Math&#39;)
  s.lessons &lt;&lt; l
  if s.some_important_method
    # all is well, keep going
  else
    tx.failure
  end
end
</code></pre>

<p>At any time, you can call <code>tx.failure</code> to invalidate the whole transaction. Neither Student nor Lesson would be created. If an exception is raised, the entire thing is rolled back, too. Pretty cool. As an added bonus, performance is improved VS individual actions because the server doesn&#39;t perform a commit until the very end.</p>

<p>In contrast with ActiveRecord, Neo4j.rb v3 does not wrap individual Create, Update, and Destroy actions in transactions. That means that a simple <code>s = Student.create</code> would be a standalone operation, as would <code>s.destroy</code>, and any callbacks that occur -- a cascading <code>destroy</code> operation of associated objects, for instance -- would all be independent, too. The solution to this is pretty simple, you just start a transaction before calling <code>destroy</code>.</p>

<p>There were two big reasons for this default in v3:</p>

<ul>
<li>First, as mentioned earlier, v3 didn&#39;t have support for transactions when it was released. We couldn&#39;t have done this if we wanted to.</li>
<li>Second, and this became a bigger problem after the basic &quot;we-just-can&#39;t-do-it&quot; problem was resolved, transaction performance in v3 was just good enough that we felt comfortable forcing this as a default.</li>
</ul>

<p>If you happened to read the blog post from December 26 about <a href="http://localhost:4567/blog/2014/12/26/performance_gains_in_4-0.html">peformance improvements in 4.0</a>, you might see where this is going. By identifying unnecessary, wasteful database queries and taking better advantage of parameterized queries, we were able to more than double performance in most queries. (It got even better, btw.) As a result, we&#39;re now in a position where we can wrap every basic database action called by an ActiveNode or ActiveRel instance in a transaction. <strong>This is a default in v4 and will be present in a new RC in coming days.</strong></p>

<p><img alt="TRANSACTIONS" src="/images/transactions.jpg" /></p>

<p>I&#39;m stoked about this because it improves the reliability of everything that happens within the gem. If there&#39;s a downside, it&#39;s that we do take a slight performance hit because every action requires a second query to close the transaction, but we&#39;ve improved performance so much that we&#39;re still in excellent shape. I think that it&#39;s a very reasonable default. The upside is that if you encounter an exception within the course of an action, the transaction will roll back -- just like it does in ActiveRecord. This is also true for callbacks related to each action, which brings us to our next topic... <a href="/blog/2015/01/07/association_dependent_options.html">Association dependent options in v4!</a></p>
</div><small>Posted 2015/01/06 by Chris Grigg<br />Tagged with <a href="/blog/tags/news.html">news</a>, <a href="/blog/tags/changelog.html">changelog</a>, <a href="/blog/tags/milestones.html">milestones</a>, <a href="/blog/tags/transactions.html">transactions</a></small></div></div><div class="col-sm-1"></div><div class="col-sm-3" id="sidebar"><div class="panel"><div class="panel-body"><p class="git-stats build-info"></p><p class="latest-release build-info"></p><p class="git-star build-info"><iframe allowtransparency="true" frameborder="0" height="20" scrolling="0" src="http://ghbtns.com/github-btn.html?user=neo4jrb&repo=neo4j&type=watch&count=true&size=small" width="110"></iframe></p><p><a href="https://travis-ci.org/neo4jrb/neo4j"><img src="https://travis-ci.org/neo4jrb/neo4j.svg?branch=master" /></a></p><p><a href="https://coveralls.io/r/neo4jrb/neo4j?branch=master"><img src="https://coveralls.io/repos/neo4jrb/neo4j/badge.png?branch=master" /></a></p><a href="https://codeclimate.com/github/neo4jrb/neo4j"><img src="https://codeclimate.com/github/neo4jrb/neo4j/badges/gpa.svg" /></a></div></div><div class="panel"><div class="panel-header"><h3>Primary maintainers</h3></div><div class="panel-body"><div class="maintainer"><h4>Chris Grigg</h4><div class="media"><div class="media-left"><img src="https://avatars.githubusercontent.com/subvertallchris" /></div><div class="media-body"><div><i class="fa fa-external-link"></i> <a href="http://blog.subvertallmedia.com/">Blog</a></div><div><i class="fa fa-github"></i> <a href="https://github.com/subvertallchris/">subvertallchris</a></div><div><i class="fa fa-twitter"></i> <a href="https://twitter.com/subvertallmedia">subvertallmedia</a></div></div></div></div><div class="maintainer"><h4>Brian Underwood</h4><div class="media"><div class="media-left"><img src="https://avatars.githubusercontent.com/cheerfulstoic" /></div><div class="media-body"><div><i class="fa fa-external-link"></i> <a href="http://blog.brian-underwood.codes/">Blog</a></div><div><i class="fa fa-github"></i> <a href="https://github.com/cheerfulstoic/">cheerfulstoic</a></div><div><i class="fa fa-twitter"></i> <a href="https://twitter.com/cheerfulstoic">cheerfulstoic</a></div></div></div></div><div><h3>E-Mail the maintainers</h3><a href="http://www.foxyform.com/" id="foxyform_embed_link_754075">foxyform</a><script type="text/javascript">(function(d, t){
   var g = d.createElement(t),
       s = d.getElementsByTagName(t)[0];
   g.src = "http://www.foxyform.com/js.php?id=754075&sec_hash=308172d01c2&width=350px";
   s.parentNode.insertBefore(g, s);
}(document, "script"));</script></div></div><div class="panel-header"><h3>Original Creator</h3></div><div class="panel-body"><div class="maintainer"><h4>Andreas Ronge</h4><div class="media"><div class="media-left"><img src="https://avatars.githubusercontent.com/andreasronge" /></div><div class="media-body"><div><i class="fa fa-external-link"></i> <a href="http://www.jayway.com/author/andreasronge/">Blog</a></div><div><i class="fa fa-github"></i> <a href="https://github.com/andreasronge">andreasronge</a></div><div><i class="fa fa-twitter"></i> <a href="https://twitter.com/ronge">ronge</a></div></div></div></div></div></div><div class="panel"><div class="panel-body"><script data-gratipay-username="cheerfulstoic" src="//grtp.co/v1.js"></script></div></div></div></div></div><script src="/javascripts/all.js" type="text/javascript"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-57970757-1', 'auto');
ga('send', 'pageview');</script></body></html>