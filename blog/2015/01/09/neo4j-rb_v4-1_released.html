<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><meta content="width=device-width, initial-scale=1.0;" name="viewport" /><title>Neo4j.rb v4.1 Released</title><link href="/stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="/stylesheets/all.css" rel="stylesheet" type="text/css" /><link href="favicon.png" rel="icon" type="image/png" /></head><body class="page_classes blog blog_2015 blog_2015_01 blog_2015_01_09 blog_2015_01_09_neo4j-rb_v4-1_released"><header class="navbar navbar-static-top"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" data-target=".bs-navbar-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="/images/logo.png" /></a></div><nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation"><ul class="nav navbar-nav"><li><a href="../../../../#latest-news">News</a></li><li><a href="http://neo4jrb.readthedocs.org/">Documentation</a></li><li><a href="../../../../#getting-started">Get started</a></li><li><a href="../../../../#getting-involved">Get involved</a></li><li><a href="../../../../#getting-help">Getting Help</a></li></ul></nav></div></header><div class="container" id="main"><div class="row"><div class="col-xs-8" id="content"><div class="panel blog-post"><div class="panel-heading"><h2>Neo4j.rb v4.1 Released</h2></div><div class="panel-body"><p>Just three months since releasing 3.0, we&#39;re proud to have Neo4j.rb 4.1, and Neo4j-core 4.0 released to the world. Are you excited? <a href="http://www.theonion.com/video/report-most-college-males-admit-to-regularly-getti,14386/">We&#39;re stoked</a>. Get it by changing your gemfile to <code>gem &#39;neo4j&#39;, &#39;~&gt; 4.1.0&#39;</code> or if you just have <code>gem &#39;neo4j&#39;</code>, a <code>bundle update neo4j</code> will do it. Please see <a href="https://github.com/neo4jrb/neo4j/wiki/Neo4j.rb-v4-Introduction">this article</a>, which outlines the potentially breaking API changes related to relationship types.</p>

<h3>What happened to 4.0?</h3>

<p>Why jump straight to 4.1? Well, we didn&#39;t really, we just released 4.0 and 4.1 within 40 minutes of each other. It&#39;s pretty simple, really:</p>

<ul>
<li>4.0.0 is 4.0.0.rc.4 (released Dec 22, 2014) with the gemspec set to require neo4j-core 4.0.0, which has no changes we expect to cause problems but many important performance fixes.</li>
<li>4.1.0 includes all of the commits made since Dec 22.</li>
</ul>

<p>This was done because we want users to trust that if rc4 worked for them, 4.0.0 can be trusted. We did not think another release candidate was necessary. 4.1.0 was born.</p>

<h3>What Changed Since 3.x?</h3>

<h4>Full Support for Neo4j 2.2</h4>

<p>This includes the new basic authentication option. A new class in Neo4j-core lets you work directly with the authentication REST endpoint. There are new rake tasks, too: <code>neo4j:enable_authentication</code>, <code>neo4j:disable_authentication</code>, and <code>neo4j:change_password</code>. <code>neo4j:install</code> has been updated to disable basic auth automatically, as this is intended for low-security dev environments.</p>

<p>We are running all of our tests against 2.2.0-M01 right now and will move to 2.2.0 when it is released. You can see our CI at <a href="https://travis-ci.org/neo4jrb/neo4j">https://travis-ci.org/neo4jrb/neo4j</a>, where you&#39;ll notice we&#39;re testing against Ruby 2.2.0, 1.9.3, and JRuby 1.7.16.</p>

<h4>SPEED</h4>

<p>Almost everything you do will be faster. Our benchmarks show performance improvements of more than 2x on most repeat queries. This is mostly thanks to changes in Neo4j-core. Read about it at <a href="http://neo4jrb.io/blog/2014/12/26/performance_gains_in_4-0.html">here</a>. This will be very noticeable in environments where your database and web servers are on two different machines.</p>

<h4>&quot;_classname&quot; properties are no longer added (Neo4j 2.1.5+)</h4>

<p><code>_classname</code>, one of our least favorite (but totally necessary) features of 3.x, is not needed anymore as long as you are running Neo4j 2.1.5 or greater, which you should be. See <a href="http://neo4jrb.io/blog/2014/12/23/the_road_to_4-0.html">http://neo4jrb.io/blog/2014/12/23/the<em>road</em>to_4-0.html</a> for more detail than you&#39;ll ever want. <a href="https://github.com/neo4jrb/neo4j/wiki/Neo4j.rb-v4-Introduction">This wiki page</a> outlines the implications of this.</p>

<h4>Better automatic relationship types</h4>

<p>If you use automatic relationship typing, <code>has_many :out, :students</code>, 4.x will now make the relationship type <code>STUDENTS</code> instead of <code>#students</code>. This is to bring it in line with Neo4j relationship naming best practices. It can be configured for legacy purposes and taste, see <a href="https://github.com/neo4jrb/neo4j/wiki/Neo4j-v3-Declared-Relationships#in-v4-declared-auto-generated-relationship-types-are-all-caps">this documentation</a>. The wiki page linked above also spells this out quite a bit.</p>

<h4>ActiveRel: automatic matching of returned relationships to models, no more explicit &quot;type&quot; required</h4>

<p>If you create an ActiveRel class called <code>EnrolledIn</code>, it will automatically set the type to <code>ENROLLED_IN</code> -- you do not need to explicitly say <code>type &#39;ENROLLED_IN&#39;</code>. It respects whatever options you set when configuration automatic relationship types as described in the documentation above.</p>

<p>As a bonus, if you create a relationship from an association, say <code>student.lessons &lt;&lt; math</code> and your Student model is set with <code>has_many :out, :lessons, type: &#39;ENROLLED_IN&#39;</code>, the <code>rel_class</code> option is unnecessary. This is all related to the death of <code>_classname</code>.</p>

<p>The flipside of this is that if your relationship model&#39;s name does not match the relationship type, you should enable <code>eager_load</code> in your Rails environment&#39;s config. See docs for more details. Once more, see <a href="https://github.com/neo4jrb/neo4j/wiki/Neo4j.rb-v4-Introduction">this page</a> for a clear walkthrough of these implications.</p>

<h4>All create, update, and destroy actions are wrapped in transactions</h4>

<p>Thanks to performance improvements in core, we can do this and things are still much faster than 3.x. See <a href="http://neo4jrb.io/blog/2015/01/06/transactions_everywhere.html">this blog post</a> for info.</p>

<h4>Scopes are more powerful</h4>

<p>You can now chain scopes and methods to QueryProxy objects. If <code>top_students</code> is defined as a scope or method in <code>Lesson</code> that finds students with certain grades, <code>Student.all.where(age: 18).lessons.top_students</code> will now work. See <a href="https://github.com/neo4jrb/neo4j/blob/master/spec/e2e/scope_spec.rb">this spec</a> for examples, with more documentation to come.</p>

<h4>Our code is cleaner and more consistent</h4>

<p>Brian spent a few days attacking both gems with Rubocop and his keen eye for detail. Rubocop compliance is now a required part of our test process. We have some strong feelings about this; see <a href="http://neo4jrb.io/blog/2014/12/29/stay-out-of-trouble.html">Brian&#39;s post on the topic</a>.</p>

<h4>New association option: <code>dependent</code></h4>

<p>Similar to ActiveRecord, <code>dependent: :delete</code> and friends are now options on associations in ActiveNode. We have some uniquely graphy options, too. See blog post <a href="http://neo4jrb.io/blog/2015/01/07/association_dependent_options.html">here</a>.</p>

<h4>Association option: <code>unique: true</code> and ActiveRel class method <code>creates_unique_rel</code></h4>

<p>Using either of these will change the Cypher used to create relationships from <code>CREATE</code> to <code>CREATE UNIQUE</code>. You can read about that in Neo4j&#39;s <a href="http://neo4j.com/docs/stable/query-create-unique.html"><code>CREATE UNIQUE</code> documentation</a>.</p>

<h4>&quot;OPTIONAL MATCH&quot; and chaining QueryProxy to Core::Query back to QueryProxy</h4>

<p>It&#39;s now possible to use Cypher&#39;s OPTIONAL MATCH in QueryProxy instead of plain ole MATCH and transform a <code>Core::Query</code> object into a friendlier <code>QueryProxy</code> object. A blog or possibly screencast is coming about this but in the meantime, the best places to see these in action are the specs: <a href="https://github.com/neo4jrb/neo4j/blob/ba0763c5f8e25a705c6c8bb5a63adf82df8cb3cf/spec/e2e/query_proxy_methods_spec.rb#L391">optional</a> and <a href="https://github.com/neo4jrb/neo4j/blob/070e6d9fdec62222f805af4f1b46a729f545e333/spec/e2e/query_spec.rb#L343">proxy_as</a>. There&#39;s also a <code>proxy_as_optional</code> method in Core::Query if you&#39;re looking for more control.</p>

<h4>A lot of new QueryProxy instance methods</h4>

<p>Things like...</p>

<ul>
<li><code>match_to</code>, for creating a match around a specific node, id, or group of nodes</li>
<li><code>rels_to</code> and <code>first_rel_to</code>, returns all rels or the first rel between a chain and a given node</li>
<li><code>rel_where</code>, like <code>where</code> but for relationships</li>
<li><code>node_where</code>, an aliased version of <code>where</code> to make things a bit more explicit and readable</li>
<li><code>delete_all</code>, deletes all matched nodes and rels within Cypher</li>
<li><code>delete</code> and <code>destroy</code>, which destroy relationships matched in Cypher and Ruby, respectively</li>
</ul>

<p>The <a href="https://github.com/neo4jrb/neo4j/blob/master/spec/e2e/query_proxy_methods_spec.rb"><code>query_proxy_methods_spec.rb</code></a> file is easy to read and demonstrates all of these, so it&#39;s a great thing to keep an eye on.</p>

<h3>Upgrading an App from 3.x to 4.x</h3>

<p>If you have a 3.x app, the upgrade process is relatively simple.</p>

<ul>
<li>If you are using automatic relationship naming, meaning you do not use the <code>type</code> option in associations, your relationship types will change. Set <code>config.neo4j.transform_rel_type = :legacy</code> in <code>application.rb</code> or update your data and modify Cypher queries based on the new automatic names. See <a href="https://github.com/neo4jrb/neo4j/wiki/Neo4j.rb-v4-Introduction#automatic-relationship-types">this</a>.</li>
<li>If the above applies to you, note that <code>transform_rel_type</code> will also affect ActiveRel&#39;s new automatic relationship naming. You should continue using <code>type</code> in your models and enable <code>eager_load</code> in your environment&#39;s config file.</li>
<li>If you are using ActiveRel and your model names do not match the relationship types (your model is <code>StudentLesson</code> and the type is <code>ENROLLED_IN</code>), enable <code>eager_load</code> in your environment&#39;s config file.</li>
<li>If you are using the same relationship type in multiple ActiveRel models, you are reliant on <code>_classname</code>. Use the class method <code>set_classname</code> in your model, continue using <code>type</code>, and enable <code>eager_load</code>, as with the other solutions.</li>
</ul>

<p>This behavior is all described in detail at <a href="https://github.com/neo4jrb/neo4j/wiki/Neo4j.rb-v4-Introduction#matching-neo4j-objects-to-classes">this page</a>. Please open an issue or reach out to one of us directly if you need help.</p>
</div><small>Posted 2015/01/09 by Chris Grigg<br />Tagged with <a href="/blog/tags/news.html">news</a>, <a href="/blog/tags/releases.html">releases</a>, <a href="/blog/tags/milestones.html">milestones</a>, <a href="/blog/tags/changelog.html">changelog</a></small></div></div><div class="col-sm-1"></div><div class="col-sm-3" id="sidebar"><div class="panel"><div class="panel-body"><p class="git-stats build-info"></p><p class="latest-release build-info"></p><p class="git-star build-info"><iframe allowtransparency="true" frameborder="0" height="20" scrolling="0" src="http://ghbtns.com/github-btn.html?user=neo4jrb&repo=neo4j&type=watch&count=true&size=small" width="110"></iframe></p><p><a href="https://travis-ci.org/neo4jrb/neo4j"><img src="https://travis-ci.org/neo4jrb/neo4j.svg?branch=master" /></a></p><p><a href="https://coveralls.io/r/neo4jrb/neo4j?branch=master"><img src="https://coveralls.io/repos/neo4jrb/neo4j/badge.png?branch=master" /></a></p><a href="https://codeclimate.com/github/neo4jrb/neo4j"><img src="https://codeclimate.com/github/neo4jrb/neo4j/badges/gpa.svg" /></a></div></div><div class="panel"><div class="panel-header"><h3>Primary maintainers</h3></div><div class="panel-body"><div class="maintainer"><h4>Chris Grigg</h4><div class="media"><div class="media-left"><img src="https://avatars.githubusercontent.com/subvertallchris" /></div><div class="media-body"><div><i class="fa fa-external-link"></i> <a href="http://blog.subvertallmedia.com/">Blog</a></div><div><i class="fa fa-github"></i> <a href="https://github.com/subvertallchris/">subvertallchris</a></div><div><i class="fa fa-twitter"></i> <a href="https://twitter.com/subvertallmedia">subvertallmedia</a></div></div></div></div><div class="maintainer"><h4>Brian Underwood</h4><div class="media"><div class="media-left"><img src="https://avatars.githubusercontent.com/cheerfulstoic" /></div><div class="media-body"><div><i class="fa fa-external-link"></i> <a href="http://blog.brian-underwood.codes/">Blog</a></div><div><i class="fa fa-github"></i> <a href="https://github.com/cheerfulstoic/">cheerfulstoic</a></div><div><i class="fa fa-twitter"></i> <a href="https://twitter.com/cheerfulstoic">cheerfulstoic</a></div></div></div></div><div><h3>E-Mail the maintainers</h3><a href="http://www.foxyform.com/" id="foxyform_embed_link_754075">foxyform</a><script type="text/javascript">(function(d, t){
   var g = d.createElement(t),
       s = d.getElementsByTagName(t)[0];
   g.src = "http://www.foxyform.com/js.php?id=754075&sec_hash=308172d01c2&width=350px";
   s.parentNode.insertBefore(g, s);
}(document, "script"));</script></div></div><div class="panel-header"><h3>Original Creator</h3></div><div class="panel-body"><div class="maintainer"><h4>Andreas Ronge</h4><div class="media"><div class="media-left"><img src="https://avatars.githubusercontent.com/andreasronge" /></div><div class="media-body"><div><i class="fa fa-external-link"></i> <a href="http://www.jayway.com/author/andreasronge/">Blog</a></div><div><i class="fa fa-github"></i> <a href="https://github.com/andreasronge">andreasronge</a></div><div><i class="fa fa-twitter"></i> <a href="https://twitter.com/ronge">ronge</a></div></div></div></div></div></div><div class="panel"><div class="panel-body"><script data-gratipay-username="cheerfulstoic" src="//grtp.co/v1.js"></script></div></div></div></div></div><script src="/javascripts/all.js" type="text/javascript"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-57970757-1', 'auto');
ga('send', 'pageview');</script></body></html>